# Upload.sh APK 發布工具使用說明

`upload.sh` 是一個 Flutter APK 自動發布工具，專門用於 VideoTV 專案的版本管理和 APK 建構。

## 🚀 主要功能

- 自動更新 pubspec.yaml 中的版本號
- 清理並重新建構 Flutter APK
- 自動將 APK 複製到 releases 目錄
- 支援自動模式和手動模式
- 自動開啟檔案管理器顯示建構結果

## 📋 使用方法

### 1. 自動模式（推薦日常使用）

```bash
./upload.sh --auto
# 或
./upload.sh -a
```

自動模式會：
- 自動增加建構號（例如：1.0.0+1 → 1.0.0+2）
- 清理建構快取
- 重新建構 APK
- 自動顯示建構結果

### 2. 手動模式（精確控制版本）

```bash
./upload.sh
```

手動模式可以選擇：
- **補丁版本** (1.0.0 → 1.0.1) - 修復 bug
- **次要版本** (1.0.0 → 1.1.0) - 新功能
- **主要版本** (1.0.0 → 2.0.0) - 重大變更
- **建構號** (1.0.0+1 → 1.0.0+2) - 測試版本

### 3. 顯示幫助

```bash
./upload.sh --help
# 或
./upload.sh -h
```

## 📁 輸出結構

建構完成後，APK 檔案會自動複製到：

```
releases/
└── videotv.apk             # 統一命名的 APK
```

## 🔧 系統需求

- Flutter SDK (已安裝並在 PATH 中)
- bash shell (macOS/Linux)
- 在 Flutter 專案根目錄執行

## 💡 使用場景

### 日常開發測試
```bash
./upload.sh --auto
```
快速增加建構號並產生新的測試 APK。

### 功能版本發布
```bash
./upload.sh
# 選擇 2 (次要版本)
```
發布包含新功能的版本。

### 緊急修復發布
```bash
./upload.sh
# 選擇 1 (補丁版本)
```
發布修復 bug 的版本。

## 🛠️ 操作流程

### 自動模式示例
```bash
$ ./upload.sh --auto
🚀 自動版本更新模式
ℹ️  檢查 Flutter 環境...
ℹ️  Flutter 版本: Flutter 3.x.x • channel stable
✅ Flutter 環境檢查完成
ℹ️  當前版本: 1.0.0+1
ℹ️  新版本: 1.0.0+2
✅ 版本號已更新為: 1.0.0+2
⚠️  將會執行以下操作：
  - 清理建構快取
  - 重新取得依賴
  - 建構發布版本 APK
  - 輸出到 releases/ 目錄

確定要繼續嗎？ (y/N): y
ℹ️  清理建構快取...
✅ 建構快取清理完成
ℹ️  開始建構 APK (版本: 1.0.0+2)...
ℹ️  建構發布版本 APK...
✅ APK 建構完成: releases/videotv.apk
ℹ️  檔案大小: 15M

🎉 APK 發布完成！
ℹ️  版本: 1.0.0+2
ℹ️  檔案位置: ./releases/videotv.apk
```

### 手動模式示例
```bash
$ ./upload.sh
🎯 手動版本更新模式
ℹ️  檢查 Flutter 環境...
✅ Flutter 環境檢查完成
ℹ️  當前版本: 1.0.0+2

版本更新選項：
1) 補丁版本 (1.0.0 -> 1.0.1) - 修復 bug
2) 次要版本 (1.0.0 -> 1.1.0) - 新功能
3) 主要版本 (1.0.0 -> 2.0.0) - 重大變更
4) 建構號   (1.0.0+1 -> 1.0.0+2) - 測試版本

請選擇版本更新類型 [1-4]: 2
ℹ️  更新次要版本
ℹ️  新版本: 1.1.0+3
✅ 版本號已更新為: 1.1.0+3

⚠️  將會執行以下操作：
  - 清理建構快取
  - 重新取得依賴
  - 建構發布版本 APK
  - 輸出到 releases/ 目錄

確定要繼續嗎？ (y/N): y
[建構過程...]
🎉 APK 發布完成！
```

## 🚨 注意事項

- 腳本會自動備份和還原版本號（如果建構失敗）
- 建議在建構前確保專案編譯無誤
- 建構過程中會清理快取，需要重新下載依賴
- macOS 系統會自動開啟 Finder 顯示建構結果
- Linux 系統會自動開啟檔案管理器

## 🔍 故障排除

### Flutter 環境問題
```bash
# 檢查 Flutter 是否正確安裝
flutter --version
flutter doctor
```

### 建構失敗
- 確保專案沒有編譯錯誤
- 檢查網路連線（需要下載依賴）
- 確保有足夠的磁碟空間

### 權限問題
```bash
# 確保腳本有執行權限
chmod +x upload.sh
```

## 📝 版本號規則

- **主要版本**：不相容的 API 變更
- **次要版本**：向後相容的新功能
- **補丁版本**：向後相容的錯誤修復
- **建構號**：每次建構自動遞增

格式：`主要.次要.補丁+建構號` (例如：1.2.3+45) 